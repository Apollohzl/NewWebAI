'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';

interface SchedulerStatus {
  isRunning: boolean;
  nextRun: string | null;
  interval: string;
}

interface BlogPost {
  id: string;
  title: string;
  category: string;
  readTime: string;
  generatedAt: string;
  isAutoGenerated: boolean;
}

interface Model {
  id: string;
  name: string;
  created: number;
}

export default function AutoBlogAdmin() {
  const [status, setStatus] = useState<SchedulerStatus | null>(null);
  const [recentPosts, setRecentPosts] = useState<BlogPost[]>([]);
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');
  const [messageType, setMessageType] = useState<'success' | 'error'>('success');
  const [previewData, setPreviewData] = useState<any>(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const [temperature, setTemperature] = useState<number>(1.0); // æ·»åŠ åˆ›é€ æ€§å‚æ•°çŠ¶æ€
  const [intervalMinutes, setIntervalMinutes] = useState<number>(60); // æ·»åŠ é—´éš”æ—¶é—´çŠ¶æ€
  const [selectedModel, setSelectedModel] = useState<string>('kimi'); // æ·»åŠ æ¨¡å‹é€‰æ‹©çŠ¶æ€
  const [models, setModels] = useState<Model[]>([]); // æ·»åŠ æ¨¡å‹åˆ—è¡¨çŠ¶æ€
  const [conversationHistory, setConversationHistory] = useState<any[]>([]); // æ·»åŠ å¯¹è¯å†å²çŠ¶æ€

  // åˆå§‹åŒ–å¯¹è¯å†å²
  useEffect(() => {
    const savedHistory = localStorage.getItem('autoBlogConversationHistory');
    if (savedHistory) {
      try {
        setConversationHistory(JSON.parse(savedHistory));
      } catch (error) {
        console.error('è§£æå¯¹è¯å†å²å¤±è´¥:', error);
        setConversationHistory([]);
      }
    }
  }, []);

  // ä¿å­˜å¯¹è¯å†å²åˆ°æœ¬åœ°å­˜å‚¨
  const saveConversationHistory = (history: any[]) => {
    try {
      localStorage.setItem('autoBlogConversationHistory', JSON.stringify(history));
      setConversationHistory(history);
    } catch (error) {
      console.error('ä¿å­˜å¯¹è¯å†å²å¤±è´¥:', error);
    }
  };

  // è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
  const fetchModels = async () => {
    try {
      const response = await fetch('/api/ai/models');
      const data = await response.json();
      
      if (response.ok && data.success && data.data) {
        setModels(data.data);
        // å¦‚æœå½“å‰é€‰æ‹©çš„æ¨¡å‹ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªæ¨¡å‹
        if (data.data.length > 0 && !data.data.some((model: Model) => model.id === selectedModel)) {
          setSelectedModel(data.data[0].id);
        }
      } else {
        console.error('è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥:', data.error);
        // å¦‚æœè·å–å¤±è´¥ï¼Œè®¾ç½®ä¸€äº›é»˜è®¤æ¨¡å‹
        setModels([
          { id: 'kimi', name: 'Kimi', created: Date.now() },
          { id: 'deepseek', name: 'DeepSeek', created: Date.now() },
          { id: 'gemini', name: 'Gemini', created: Date.now() },
          { id: 'openai', name: 'OpenAI', created: Date.now() },
          { id: 'claude', name: 'Claude', created: Date.now() }
        ]);
      }
    } catch (error) {
      console.error('è·å–æ¨¡å‹åˆ—è¡¨æ—¶å‡ºé”™:', error);
      // å‡ºé”™æ—¶è®¾ç½®ä¸€äº›é»˜è®¤æ¨¡å‹
      setModels([
        { id: 'kimi', name: 'Kimi', created: Date.now() },
        { id: 'deepseek', name: 'DeepSeek', created: Date.now() },
        { id: 'gemini', name: 'Gemini', created: Date.now() },
        { id: 'openai', name: 'OpenAI', created: Date.now() },
        { id: 'claude', name: 'Claude', created: Date.now() }
      ]);
    }
  };

  // è·å–çŠ¶æ€
  const fetchStatus = async () => {
    try {
      const response = await fetch('/api/auto-blog/scheduler');
      const data = await response.json();
      
      if (response.ok) {
        setStatus(data.scheduler);
        setRecentPosts(data.recentPosts || []);
        // å¦‚æœæœ‰è®¾ç½®çš„é—´éš”æ—¶é—´ï¼Œæ›´æ–°æœ¬åœ°çŠ¶æ€
        if (data.scheduler?.intervalMinutes) {
          setIntervalMinutes(data.scheduler.intervalMinutes);
        }
      } else {
        setMessage('è·å–çŠ¶æ€å¤±è´¥');
        setMessageType('error');
      }
    } catch (error) {
      setMessage('ç½‘ç»œé”™è¯¯');
      setMessageType('error');
    }
  };

  // æ§åˆ¶å®šæ—¶å™¨
  const controlScheduler = async (action: string) => {
    setLoading(true);
    setMessage('');
    
    try {
      const response = await fetch('/api/auto-blog/scheduler', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
          action,
          intervalMinutes: action === 'start' ? intervalMinutes : undefined // åªåœ¨å¯åŠ¨æ—¶ä¼ é€’é—´éš”æ—¶é—´
        }),
      });
      
      const data = await response.json();
      
      if (data.success) {
        setMessage(data.message);
        setMessageType('success');
        // ç­‰å¾…ä¸€ç§’ååˆ·æ–°çŠ¶æ€
        setTimeout(fetchStatus, 1000);
      } else {
        setMessage(data.error || 'æ“ä½œå¤±è´¥');
        setMessageType('error');
      }
    } catch (error) {
      setMessage('ç½‘ç»œé”™è¯¯');
      setMessageType('error');
    } finally {
      setLoading(false);
    }
  };

  // æ‰‹åŠ¨ç”Ÿæˆåšå®¢
  const generateBlog = async () => {
    setLoading(true);
    setIsGenerating(true);
    setMessage('');
    setPreviewData(null); // æ¸…ç©ºä¹‹å‰çš„é¢„è§ˆæ•°æ®
    
    try {
      // ç¬¬ä¸€æ­¥ï¼šè°ƒç”¨AIç”Ÿæˆå†…å®¹
      setMessage(`æ­£åœ¨è°ƒç”¨${selectedModel}æ¨¡å‹ç”Ÿæˆå†…å®¹(åˆ›é€ æ€§: ${temperature})...`);
      const aiResponse = await fetch('/api/ai-chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          messages: [
            ...conversationHistory,
            { 
              role: 'user', 
              content: `ç°åœ¨ä½ æ˜¯ä¸€ä¸ªå¸–å­æ™ºèƒ½ç¼–è¾‘å‘˜ï¼Œä½ æ¯æ¬¡è¾“å‡ºéƒ½éœ€è¦ä»¥jsonçº¯æ–‡æœ¬æ ¼å¼è¾“å‡ºï¼Œç¦æ­¢æ¢è¡Œï¼Œç¦æ­¢ä½¿ç”¨mdæ ¼å¼ã€‚å†…å®¹è¦æ±‚ï¼Œéœ€è¦æä¾›category :  "æ–‡ç« ç±»å‹åˆ†ç±»ï¼Œå¦‚éŸ³ä¹ï¼Œè‰ºæœ¯ï¼Œç”Ÿæ´»"ï¼Œexcerpt :  "æ‘˜è¦"ï¼Œtags :["æ ‡ç­¾1","æ ‡ç­¾2"]ï¼Œtitle :  "æ ‡é¢˜"ï¼Œcontent :  "åˆ›å»ºä¸€ä¸ªhtmlé¡µé¢ï¼Œä¸å‡†ä½¿ç”¨jsï¼Œé¡µé¢å¥½çœ‹ä¸€ç‚¹ï¼Œå¯ä»¥å¼•å…¥å›¾ç‰‡ï¼Œåªæ”¯æŒaæ ‡ç­¾è·³è½¬ï¼Œä½ è¿™ä¸ªå¸–å­æ˜¯é•¶åµŒåœ¨ä¸€ä¸ªå¸–å­é¡µé¢é‡Œçš„ä¸€ä¸ªå®¹å™¨é‡Œçš„ï¼Œç”¨æ¥å±•ç¤ºè¿™ä¸ªå¸–å­çš„å†…å®¹çš„æ‰€ä»¥è¯·ç¼–å†™æ—¶ä¸è¦ä¿®æ”¹å…¶ä»–çš„ä¼šå½±å“å…¶ä»–ä¸œè¥¿çš„ç¨‹åºï¼Œé‡Œé¢çš„å†…å®¹å¯ä»¥è‡ªå·±å‘æŒ¥ï¼Œæƒ³äº›ä»€ä¹ˆéƒ½å¯ä»¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¬å¼€çš„å¸–å­ç³»ç»Ÿï¼Œé¢å‘çš„æ˜¯å…¨ä¸–ç•Œ"ã€‚å°±æ˜¯è¿™å‡ ä¸ªå€¼å°±è¡Œã€‚contentç¤ºä¾‹ï¼š <div class='blog-post'><style>.blog-post {font-family: 'Segoe UI', system-ui, sans-serif; line-height: 1.7; color: #333;}.post-title {font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1.5rem; border-left: 5px solid #667eea; padding-left: 1rem;}.section-title {font-size: 1.5rem; color: #2d3748; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; margin: 2rem 0 1rem;}.feature-box {background: linear-gradient(135deg, #f6f9ff 0%, #f0f4ff 100%); border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);}.code-block {background: #1a202c; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: 'Fira Code', monospace; margin: 1.5rem 0; overflow-x: auto;}.tech-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0;}.tech-card {background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); transition: transform 0.3s ease; border-top: 4px solid #4299e1;}.tech-card:hover {transform: translateY(-5px);}.feature-list li {padding: 0.5rem 0; position: relative; padding-left: 1.5rem;}.feature-list li:before {content: 'âš¡'; position: absolute; left: 0; color: #4299e1;}.img-container {text-align: center; margin: 2rem 0;}.tech-img {max-width: 100%; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);}</style><h1 class='post-title'>Next.js 15å…¨æ ˆå¼€å‘æŒ‡å—ï¼šApp Routerã€æœåŠ¡ç«¯ç»„ä»¶ä¸ç°ä»£Webæ¶æ„</h1><div class='img-container'><img src='https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=1200&h=600&fit=crop' alt='Next.jså¼€å‘ç•Œé¢' class='tech-img' width='800' height='400'></div><p>éšç€Next.js 15çš„å‘å¸ƒï¼ŒReactå…¨æ ˆå¼€å‘è¿›å…¥äº†æ–°çš„æ—¶ä»£ã€‚æœ¬æ¬¡æ›´æ–°ä¸ä»…å¸¦æ¥äº†<strong>æ€§èƒ½çš„æ˜¾è‘—æå‡</strong>ï¼Œæ›´é‡è¦çš„æ˜¯<strong>å¼€å‘ä½“éªŒçš„é©å‘½æ€§æ”¹è¿›</strong>ï¼Œç‰¹åˆ«æ˜¯å¯¹App Routerçš„å…¨é¢ä¼˜åŒ–å’ŒæœåŠ¡ç«¯ç»„ä»¶çš„æˆç†Ÿåº”ç”¨ã€‚</p><section><h2 class='section-title'>ğŸš€ App Routerçš„æ·±åº¦ä¼˜åŒ–</h2><div class='feature-box'><p><strong>å¹¶è¡Œè·¯ç”±ä¸æ‹¦æˆªè·¯ç”±</strong>è®©å¤æ‚å¸ƒå±€çš„å®ç°å˜å¾—ç®€å•ã€‚ç°åœ¨ä½ å¯ä»¥è½»æ¾åˆ›å»ºæ¨¡æ€å¯¹è¯æ¡†ã€æ¡ä»¶æ€§å¸ƒå±€å’ŒåŠ¨æ€è·¯ç”±ç»“æ„ï¼š</p><div class='code-block'>// å¹¶è¡Œè·¯ç”±é…ç½®ç¤ºä¾‹<br>export default function Layout({<br>  children,<br>  modal,<br>  analytics<br>}: {<br>  children: React.ReactNode<br>  modal: React.ReactNode<br>  analytics: React.ReactNode<br>}) {<br>  return (<br>    &lt;&gt;<br>      {children}<br>      {modal}<br>      &lt;aside&gt;{analytics}&lt;/aside&gt;<br>    &lt;/&gt;<br>  )<br>}</div></div><ul class='feature-list'><li>æ”¹è¿›çš„åŠ è½½çŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒéª¨æ¶å±å’Œæ¸è¿›å¼æ¸²æŸ“</li><li>å¢å¼ºçš„é”™è¯¯è¾¹ç•Œå¤„ç†ï¼Œæä¾›æ›´å‹å¥½çš„é”™è¯¯æ¢å¤ä½“éªŒ</li><li>æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li></ul></section><section><h2 class='section-title'>ğŸ”§ æœåŠ¡ç«¯ç»„ä»¶æœ€ä½³å®è·µ</h2><p>Next.js 15è¿›ä¸€æ­¥å¼ºåŒ–äº†æœåŠ¡ç«¯ç»„ä»¶çš„åœ°ä½ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿæ›´è‡ªç„¶åœ°ç¼–å†™<em>æœåŠ¡ç«¯ä¼˜å…ˆ</em>çš„åº”ç”¨ï¼š</p><div class='tech-grid'><div class='tech-card'><h3>æ•°æ®è·å–ä¼˜åŒ–</h3><p>æ”¯æŒæµå¼ä¼ è¾“å’Œæ¸è¿›å¼æ•°æ®åŠ è½½ï¼Œæ˜¾è‘—å‡å°‘é¦–æ¬¡å†…å®¹ç»˜åˆ¶æ—¶é—´</p></div><div class='tech-card'><h3>SEOå¢å¼º</h3><p>è‡ªåŠ¨ç”Ÿæˆè¯­ä¹‰åŒ–HTMLç»“æ„ï¼Œæ”¹å–„æœç´¢å¼•æ“å¯è®¿é—®æ€§</p></div><div class='tech-card'><h3>æ€§èƒ½ç›‘æ§</h3><p>å†…ç½®æ€§èƒ½æŒ‡æ ‡è·Ÿè¸ªï¼Œæä¾›è¯¦ç»†çš„Core Web VitalsæŠ¥å‘Š</p></div></div></section><section><h2 class='section-title'>ğŸ¯ å¼€å‘å·¥å…·å‡çº§</h2><p>å…¨æ–°çš„å¼€å‘æœåŠ¡å™¨<strong>Turbopack</strong>ç°åœ¨è¾¾åˆ°ç¨³å®šçŠ¶æ€ï¼Œæä¾›ï¼š</p><ul class='feature-list'><li>çƒ­æ›´æ–°é€Ÿåº¦æå‡è‡³3å€ä»¥ä¸Š</li><li>å†…å­˜ä½¿ç”¨å‡å°‘50%</li><li>TypeScriptç¼–è¯‘æ—¶é—´ä¼˜åŒ–70%</li></ul><p>ç»“åˆReact 19çš„æ–°ç‰¹æ€§ï¼Œå¦‚<code>useOptimistic</code>å’Œ<code>useActionState</code>ï¼Œå¼€å‘ä½“éªŒå¾—åˆ°å…¨é¢æå‡ã€‚</p></section><p class='feature-box'><strong>è¿ç§»å»ºè®®ï¼š</strong>ç°æœ‰é¡¹ç›®å»ºè®®é€æ­¥è¿ç§»åˆ°App Routerï¼Œä¼˜å…ˆä»é™æ€é¡µé¢å¼€å§‹ã€‚æ–°é¡¹ç›®ç›´æ¥é‡‡ç”¨Next.js 15çš„å…¨æ ˆæ¶æ„ï¼Œå……åˆ†åˆ©ç”¨æœåŠ¡ç«¯ç»„ä»¶çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><p>Next.js 15æ ‡å¿—ç€å…¨æ ˆå¼€å‘çš„æˆç†Ÿï¼Œé€šè¿‡<em>ç®€åŒ–çš„API</em>ã€<em>ä¼˜åŒ–çš„æ€§èƒ½</em>å’Œ<em>å¢å¼ºçš„å¼€å‘å·¥å…·</em>ï¼Œä¸ºæ„å»ºç°ä»£Webåº”ç”¨æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚</p></div>ä¸è¦ç…§æŠ„æˆ‘è¿™ä¸ªç¤ºä¾‹çš„å†…å®¹å’Œæ¨¡æ¿ï¼`
            }
          ],
          model: selectedModel, // ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„æ¨¡å‹
          temperature: temperature, // ä½¿ç”¨å¯è°ƒæ•´çš„åˆ›é€ æ€§å‚æ•°
          max_tokens: 6000
        })
      });

      if (!aiResponse.ok) {
        throw new Error('AIç”Ÿæˆå¤±è´¥');
      }

      const aiData = await aiResponse.json();
      if (!aiData.success || !aiData.data) {
        throw new Error('AIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
      }

      // è§£æAIè¿”å›çš„JSONæ•°æ®
      let aiResponseContent = aiData.data.message || aiData.data;
      
      // ç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°
      const cleanResponse = aiResponseContent.replace(/```json\n?|```/g, '').trim();
      
      let parsedData;
      try {
        parsedData = JSON.parse(cleanResponse);
      } catch (parseError) {
        console.error('JSONè§£æå¤±è´¥:', parseError);
        console.error('AIè¿”å›å†…å®¹:', cleanResponse);
        throw new Error('AIè¿”å›çš„å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
      }

      // ä¿å­˜å½“å‰å¯¹è¯åˆ°å†å²è®°å½•
      const updatedHistory = [
        ...conversationHistory,
        { role: 'user', content: messages[messages.length - 1].content }, // æœ€åä¸€æ¡ç”¨æˆ·æ¶ˆæ¯
        { role: 'assistant', content: aiResponseContent } // AIçš„å“åº”
      ];
      
      // é™åˆ¶å†å²è®°å½•é•¿åº¦ï¼Œé¿å…å­˜å‚¨è¿‡å¤§
      const limitedHistory = updatedHistory.slice(-20); // åªä¿ç•™æœ€è¿‘20æ¡å¯¹è¯
      saveConversationHistory(limitedHistory);

      // è®¾ç½®é¢„è§ˆæ•°æ®
      setPreviewData(parsedData);
      setMessage('AIç”Ÿæˆå†…å®¹æˆåŠŸï¼Œè¯·é¢„è§ˆå¹¶ç¡®è®¤å‘å¸ƒ');
      setMessageType('success');
    } catch (error: any) {
      console.error('ç”Ÿæˆåšå®¢å¤±è´¥:', error);
      setMessage(error.message || 'ç”Ÿæˆåšå®¢å¤±è´¥');
      setMessageType('error');
    } finally {
      setLoading(false);
      setIsGenerating(false);
    }
  };

  // ç¡®è®¤å‘å¸ƒåšå®¢
  const confirmPublish = async () => {
    if (!previewData) {
      setMessage('æ²¡æœ‰é¢„è§ˆæ•°æ®å¯å‘å¸ƒ');
      setMessageType('error');
      return;
    }

    setLoading(true);
    setMessage('æ­£åœ¨å‘å¸ƒåšå®¢...');

    try {
      const createResponse = await fetch('/api/blog/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          title: previewData.title,
          content: previewData.content,
          category: previewData.category || 'ç”Ÿæ´»',
          excerpt: previewData.excerpt || '',
          tags: previewData.tags || ['ç”Ÿæ´»'],
          author: 'hzliflow-kimiai',
          readTime: '1 åˆ†é’Ÿé˜…è¯»',
          status: 'æ­£å¸¸',
          published: true,
          keywords: previewData.tags || ['ç”Ÿæ´»']
        }),
      });

      const createData = await createResponse.json();

      if (!createResponse.ok || !createData.success) {
        throw new Error(createData.error || 'åšå®¢åˆ›å»ºå¤±è´¥');
      }

      setMessage('åšå®¢å‘å¸ƒæˆåŠŸï¼');
      setMessageType('success');
      setPreviewData(null); // æ¸…ç©ºé¢„è§ˆæ•°æ®
      setTimeout(fetchStatus, 1000);
    } catch (error: any) {
      console.error('å‘å¸ƒåšå®¢å¤±è´¥:', error);
      setMessage(error.message || 'å‘å¸ƒåšå®¢å¤±è´¥');
      setMessageType('error');
    } finally {
      setLoading(false);
    }
  };

  // åˆå§‹åŒ–
  useEffect(() => {
    fetchModels(); // è·å–æ¨¡å‹åˆ—è¡¨
    fetchStatus();
    
    // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡çŠ¶æ€
    const interval = setInterval(fetchStatus, 30000);
    
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="min-h-screen bg-gray-50">
      {/* æ³¨å…¥é¢„è§ˆå†…å®¹æ‰€éœ€çš„æ ·å¼ */}
      <style>{`
        .preview-content {
          font-family: 'Segoe UI', system-ui, sans-serif;
          line-height: 1.7;
          color: #333;
        }
        .preview-content .post-title {
          font-size: 2.5rem;
          font-weight: 800;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          margin-bottom: 1.5rem;
          border-left: 5px solid #667eea;
          padding-left: 1rem;
        }
        .preview-content .section-title {
          font-size: 1.5rem;
          color: #2d3748;
          border-bottom: 2px solid #e2e8f0;
          padding-bottom: 0.5rem;
          margin: 2rem 0 1rem;
        }
        .preview-content .feature-box {
          background: linear-gradient(135deg, #f6f9ff 0%, #f0f4ff 100%);
          border-radius: 12px;
          padding: 1.5rem;
          margin: 1.5rem 0;
          border: 1px solid #e2e8f0;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .preview-content .code-block {
          background: #1a202c;
          color: #e2e8f0;
          padding: 1.5rem;
          border-radius: 8px;
          font-family: 'Fira Code', monospace;
          margin: 1.5rem 0;
          overflow-x: auto;
        }
        .preview-content .tech-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 1.5rem;
          margin: 2rem 0;
        }
        .preview-content .tech-card {
          background: white;
          border-radius: 10px;
          padding: 1.5rem;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
          transition: transform 0.3s ease;
          border-top: 4px solid #4299e1;
        }
        .preview-content .tech-card:hover {
          transform: translateY(-5px);
        }
        .preview-content .feature-list li {
          padding: 0.5rem 0;
          position: relative;
          padding-left: 1.5rem;
        }
        .preview-content .feature-list li:before {
          content: 'âš¡';
          position: absolute;
          left: 0;
          color: #4299e1;
        }
        .preview-content .img-container {
          text-align: center;
          margin: 2rem 0;
        }
        .preview-content .tech-img {
          max-width: 100%;
          border-radius: 12px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
      `}</style>
      
      {/* å¯¼èˆªæ  */}
      <nav className="bg-white shadow-sm">
        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
          <Link href="/" className="flex items-center space-x-2">
            <span className="text-xl font-bold text-blue-600">NewWebAI</span>
          </Link>
          <div className="hidden md:flex space-x-6">
            <Link href="/blog" className="text-blue-600 font-medium">åšå®¢</Link>
            <Link href="/store" className="text-black hover:text-blue-600">äº§å“</Link>
          </div>
        </div>
      </nav>

      <div className="container mx-auto px-4 py-8 max-w-4xl">
        <div className="bg-white rounded-xl shadow-md p-8">
          <h1 className="text-3xl font-bold text-black mb-8">è‡ªåŠ¨åšå®¢ç”Ÿæˆç®¡ç†</h1>

          {/* çŠ¶æ€æ˜¾ç¤º */}
          {status && (
            <div className="mb-8 p-6 bg-gray-50 rounded-lg">
              <h2 className="text-xl font-semibold text-black mb-4">å®šæ—¶å™¨çŠ¶æ€</h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <span className="text-sm text-gray-600">è¿è¡ŒçŠ¶æ€</span>
                  <p className={`text-lg font-medium ${status.isRunning ? 'text-green-600' : 'text-red-600'}`}>
                    {status.isRunning ? 'âœ… è¿è¡Œä¸­' : 'â¹ï¸ å·²åœæ­¢'}
                  </p>
                </div>
                <div>
                  <span className="text-sm text-gray-600">æ‰§è¡Œé—´éš”</span>
                  <p className="text-lg font-medium text-black">{status.interval}</p>
                </div>
                <div>
                  <span className="text-sm text-gray-600">ä¸‹æ¬¡æ‰§è¡Œ</span>
                  <p className="text-lg font-medium text-black">
                    {status.nextRun ? new Date(status.nextRun).toLocaleString('zh-CN') : 'æœªå®‰æ’'}
                  </p>
                </div>
              </div>
            </div>
          )}

          {/* æ§åˆ¶æŒ‰é’® */}
          <div className="mb-8">
            <h2 className="text-xl font-semibold text-black mb-4">æ§åˆ¶é¢æ¿</h2>
            
            {/* åˆ›é€ æ€§è°ƒæ•´ */}
            <div className="mb-6 p-4 bg-gray-50 rounded-lg">
              <div className="flex items-center justify-between mb-2">
                <label className="font-medium text-black">AIåˆ›é€ æ€§: {temperature.toFixed(1)}</label>
                <span className="text-sm text-gray-600">èŒƒå›´: 0.0 - 2.0</span>
              </div>
              <input
                type="range"
                min="0"
                max="2"
                step="0.1"
                value={temperature}
                onChange={(e) => setTemperature(parseFloat(e.target.value))}
                className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              />
              <div className="flex justify-between text-xs text-gray-500 mt-1">
                <span>ä¿å®ˆ</span>
                <span>å¹³è¡¡</span>
                <span>åˆ›æ–°</span>
              </div>
            </div>
            
            {/* AIæ¨¡å‹é€‰æ‹© */}
            <div className="mb-6 p-4 bg-gray-50 rounded-lg">
              <div className="flex items-center justify-between mb-2">
                <label className="font-medium text-black">AIæ¨¡å‹é€‰æ‹©</label>
                <span className="text-sm text-gray-600">é€‰æ‹©ç”¨äºç”Ÿæˆåšå®¢çš„AIæ¨¡å‹</span>
              </div>
              <select
                value={selectedModel}
                onChange={(e) => setSelectedModel(e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-white"
              >
                {models.map((model) => (
                  <option key={model.id} value={model.id}>
                    {model.name}
                  </option>
                ))}
              </select>
            </div>
            
            {/* é—´éš”æ—¶é—´è®¾ç½® - ä»…å½“å®šæ—¶å™¨æœªè¿è¡Œæ—¶æ˜¾ç¤º */}
            {!status?.isRunning && (
              <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                <div className="flex items-center justify-between mb-2">
                  <label className="font-medium text-black">æ‰§è¡Œé—´éš”: {intervalMinutes} åˆ†é’Ÿ</label>
                  <span className="text-sm text-gray-600">èŒƒå›´: 10 - 1440 åˆ†é’Ÿ (10åˆ†é’Ÿåˆ°24å°æ—¶)</span>
                </div>
                <input
                  type="range"
                  min="10"
                  max="1440"
                  step="10"
                  value={intervalMinutes}
                  onChange={(e) => setIntervalMinutes(parseInt(e.target.value))}
                  className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
                <div className="flex justify-between text-xs text-gray-500 mt-1">
                  <span>10åˆ†é’Ÿ</span>
                  <span>24å°æ—¶</span>
                </div>
                <div className="mt-2 text-sm text-gray-600">
                  <label>
                    æˆ–æ‰‹åŠ¨è¾“å…¥: 
                    <input
                      type="number"
                      min="10"
                      max="1440"
                      value={intervalMinutes}
                      onChange={(e) => setIntervalMinutes(parseInt(e.target.value) || 60)}
                      className="ml-2 w-20 px-2 py-1 border border-gray-300 rounded"
                    />
                  </label>
                </div>
              </div>
            )}
            
            <div className="flex flex-wrap gap-4">
              {!status?.isRunning ? (
                <button
                  onClick={() => controlScheduler('start')}
                  disabled={loading}
                  className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition"
                >
                  {loading ? 'å¯åŠ¨ä¸­...' : 'å¯åŠ¨å®šæ—¶å™¨'}
                </button>
              ) : (
                <button
                  onClick={() => controlScheduler('stop')}
                  disabled={loading}
                  className="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition"
                >
                  {loading ? 'åœæ­¢ä¸­...' : 'åœæ­¢å®šæ—¶å™¨'}
                </button>
              )}
              
              <button
                onClick={() => controlScheduler('restart')}
                disabled={loading}
                className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition"
              >
                {loading ? 'é‡å¯ä¸­...' : 'é‡å¯å®šæ—¶å™¨'}
              </button>
              
              <button
                onClick={generateBlog}
                disabled={loading}
                className="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition"
              >
                {isGenerating ? 'ç”Ÿæˆä¸­...' : 'æ‰‹åŠ¨ç”Ÿæˆåšå®¢'}
              </button>
              
              {previewData && (
                <button
                  onClick={confirmPublish}
                  disabled={loading}
                  className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition"
                >
                  {loading ? 'å‘å¸ƒä¸­...' : 'ç¡®è®¤å‘å¸ƒ'}
                </button>
              )}
            </div>
          </div>

          {/* æ¶ˆæ¯æ˜¾ç¤º */}
          {message && (
            <div className={`mb-8 p-4 rounded-lg ${
              messageType === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'
            }`}>
              {message}
            </div>
          )}

          {/* é¢„è§ˆåŒºåŸŸ */}
          {previewData && (
            <div className="mb-8">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold text-black">å†…å®¹é¢„è§ˆ</h2>
                <button
                  onClick={() => setPreviewData(null)}
                  className="text-sm bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 transition"
                >
                  å–æ¶ˆé¢„è§ˆ
                </button>
              </div>
              <div className="border border-gray-200 rounded-lg p-6 bg-white">
                <div className="mb-4">
                  <h3 className="text-lg font-semibold text-black">{previewData.title}</h3>
                  <div className="flex flex-wrap gap-2 mt-2">
                    <span className="px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded">
                      {previewData.category || 'ç”Ÿæ´»'}
                    </span>
                    {previewData.tags && previewData.tags.map((tag: string, index: number) => (
                      <span key={index} className="px-2 py-1 bg-green-100 text-green-800 text-sm rounded">
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>
                <div className="text-gray-600 mb-4">
                  {previewData.excerpt}
                </div>
                <div className="border-t border-gray-200 pt-4">
                  <h4 className="font-medium text-black mb-2">æ­£æ–‡é¢„è§ˆï¼š</h4>
                  <div 
                    className="preview-content"
                    dangerouslySetInnerHTML={{ __html: previewData.content }} 
                  />
                </div>
              </div>
            </div>
          )}

          {/* æœ€è¿‘ç”Ÿæˆçš„åšå®¢ */}
          <div>
            <h2 className="text-xl font-semibold text-black mb-4">æœ€è¿‘ç”Ÿæˆçš„åšå®¢</h2>
            {recentPosts.length === 0 ? (
              <div className="text-center py-8 text-gray-500">
                æš‚æ— è‡ªåŠ¨ç”Ÿæˆçš„åšå®¢
              </div>
            ) : (
              <div className="space-y-4">
                {recentPosts.map((post) => (
                  <div key={post.id} className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
                    <div className="flex justify-between items-start mb-2">
                      <h3 className="text-lg font-medium text-black">{post.title}</h3>
                      <span className="text-sm text-blue-600 bg-blue-50 px-2 py-1 rounded">
                        {post.category}
                      </span>
                    </div>
                    <div className="flex items-center text-sm text-gray-600 space-x-4">
                      <span>{post.readTime}</span>
                      <span>â€¢</span>
                      <span>ç”Ÿæˆæ—¶é—´: {new Date(post.generatedAt).toLocaleString('zh-CN')}</span>
                      <span>â€¢</span>
                      <span className="text-green-600">
                        {post.isAutoGenerated ? 'è‡ªåŠ¨ç”Ÿæˆ' : 'æ‰‹åŠ¨åˆ›å»º'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* è¯´æ˜ä¿¡æ¯ */}
          <div className="mt-8 p-6 bg-blue-50 rounded-lg">
            <h3 className="text-lg font-semibold text-black mb-2">ä½¿ç”¨è¯´æ˜</h3>
            <ul className="text-black space-y-1 text-sm">
              <li>â€¢ å®šæ—¶å™¨å¯åŠ¨åï¼Œæ¯å°æ—¶è‡ªåŠ¨ç”Ÿæˆä¸€ç¯‡åšå®¢</li>
              <li>â€¢ åšå®¢å†…å®¹ä½¿ç”¨AIå¯¹è¯APIç”Ÿæˆï¼Œä¸»é¢˜éšæœºé€‰æ‹©</li>
              <li>â€¢ ç”Ÿæˆçš„åšå®¢ä¼šè‡ªåŠ¨ä¿å­˜åˆ°LeanCloudæ•°æ®åº“</li>
              <li>â€¢ å¯ä»¥éšæ—¶å¯åŠ¨ã€åœæ­¢æˆ–é‡å¯å®šæ—¶å™¨</li>
              <li>â€¢ æ”¯æŒæ‰‹åŠ¨ç”Ÿæˆåšå®¢è¿›è¡Œæµ‹è¯•</li>
              <li>â€¢ å®šæ—¶å™¨åœ¨æœåŠ¡å™¨é‡å¯åä¼šåœæ­¢ï¼Œéœ€è¦æ‰‹åŠ¨é‡å¯</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
}