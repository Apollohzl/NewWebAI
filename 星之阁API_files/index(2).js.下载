var api = new Vue({
    el: '#api',
    data: {
        // api列表 状态码设定：0：维护，1：正常
        api_list: [],
        //公告内容
        Notice: [],
        // 公告开关
        Notice_open: false,
        // 提示开关
        Tips_open: false,
        // 搜索接口开关
        search_open: false,
        //搜索内容
        searchContent: '',
        searchResult: true,
        // 搜索结果
        apis: [],
        // 反馈开关
        feedback: false,
    },
    created() {
        // 获取api列表
        fetch('/data/api/index/?type=get_apilist')
            .then(response => response.json())
            .then(json => {
                if (json.code == 0) {
                    this.api_list = json.data;
                }
            });
        // 获取公告内容
        fetch('/data/api/index/?type=get_Notice')
            .then(response => response.json())
            .then(json => {
                if (json.code == 0) {
                    this.Notice = json.data.content.replace(/[\n\r]/g, '<br>');
                    this.Notice_open = true;
                    // if (json.data.open && this.Notice != '' && this.Notice != null) {//判断是否开启公告
                    //     if (!this.getCookie("Notice")) {//判断公告cookie是否存在
                    //         //公告弹窗
                    //         this.Notice_open = true;
                    //         //添加公告cookie，时效1天
                    //         this.setCookie("Notice", "true", 1, "/");
                    //     }
                    // }
                }
            });
    },
    watch: {
        searchContent: function (val) {
            var list = this.api_list;
            if (!list) {
                this.searchResult = false;
                return;
            }
            var apilist = new Array();
            if (val) {
                // 模拟后端搜索，暂时懒得写后端
                for (var i = 0; i < list.length; i++) {
                    // 搜索并过滤掉维护的api  && list[i].state == 1
                    if (eval("/" + val + "/i").test(list[i].name)) {
                        apilist.push(list[i]);
                    }
                }
                console.log(apilist);
                if (apilist.length != 0) {
                    this.searchResult = true;
                    this.apis = apilist;
                } else {
                    this.searchResult = false;
                }
            } else {
                this.searchResult = true;
                this.apis = [];
            }
        },
        // 监听api_list值的变化
        api_list: function () {
            this.$nextTick(() => {
                // 执行方法
                document.getElementById("loading").style.display = "none";
            });
        }
    },
    methods: {
        // 打开接口文档
        urldoc: function (state, id) {
            if (state != 1) {
                this.Tips_open = true;
            } else {
                // location.href = ''/doc/' + id;// 当前窗口打开
                window.open('/doc/' + id);// 新窗口打开
            }
        },
        //设置cookie 名称，值，时间(天)，路径
        setCookie: function (name, value, time, path) {
            var d = new Date();//创建 Date 对象
            // setTime() 方法以毫秒设置 Date 对象。
            // getTime() 返回距 1970 年 1 月 1 日之间的毫秒数
            d.setTime(d.getTime() + (time * 86400 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = name + "=" + value + "; " + expires + ";path=" + path;
        },
        //获取cookie
        getCookie: function (cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1);
                if (c.indexOf(name) != -1) return c.substring(name.length, c.length);
            }
            return "";
        },

    },
    mounted: function () {

    }
});
// 锁定输入
// function focusInput() {
//     setTimeout(function () {
//         document.getElementById('searchbox').focus();
//     }, 100);
// }